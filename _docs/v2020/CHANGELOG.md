# 前言

這次（2020）的官網改版，沒辦法像上次（2016 - 2017）一樣直接排半年來做，基本上是每遇到一個連假，就做一個階段。至於每個階段具體要做什麼，就看連假的長度、還有當下最緊急的需求是什麼而定，且戰且走。

整體改版原則：
* use convention over configuration
* automatically generate variables as possible
* improve readability of templates
* reduce data fields
* reduce entrances for maintainers
* respond to requirements from ocf staff

# 第一階段：2020/01 - 2020/03

以往舊的專案架構，每次換年份的時候，維護專案的苦主就要把專案資料複製一份，貼到新年度的資料夾。這次改版適逢 2019 進入 2020 ，因此第一階段的目標是優先解決這個「每次過年就要複製資料兼改網站設定」的問題。

## 調整設定目前年度的方式

|  | 舊版 | 新版 |
| -------- | -------- | -------- |
| 年度設定檔 | _data/settings.yml | 不需設定，依系統時間自動判斷


## 調整 UI 與動線

### 全站導覽

| 切換語系的方式 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 切換到 En 版網站 | Click on `En` | Click on `En` |
| 切換到 Tw 版網站 | Click on logo | Click on `Tw` |
> 切換語系選項的位置： header, sidebar, footer

| 打開連結的方式 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 站內連結 | configurable, default `_blank` | current tab |
| 站外連結 | configurable, default `_blank` | a new tab |

### 專案導覽

| 從專案網頁 | 舊版 | 新版 |
| -------- | -------- | -------- |
| to event page | links in event footers | event titles |
| to child project page | n/a | child project titles in the sidebar |
| to parent project page | n/a | page header |
| to freestyle page | n/a | setup links manually |

| 從活動網頁 | 舊版 | 新版 |
| -------- | -------- | -------- |
| to project page | page header | page header |

| 從自由頁面 | 舊版 | 新版 |
| -------- | -------- | -------- |
| to project page | n/a | page header |

## 調整 .html 網頁檔

### 檔案位置

| 專案網頁的位置 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 網頁檔 | p/`YYYY`/`id`/index.html <br /> p/`id`/index.html | p/`id`/index.html <br /> p/`id`/`id`/index.html
| 範例檔 | p/_yyyy/_project_id/index.html | p/project_id/index.html <br /> p/project_id/sub_project_id/index.html
> `YYYY` 為年份，如 2019, 2020
> `id` 為專案 id，如 admin, coscup，第二層是子專案的 id

| 活動網頁的位置 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 網頁檔 | p/`YYYY`/`id`/`event_id`.html <br /> p/`id`/`event_id`.html | p/`id`/`event_id`.html <br /> p/`id`/`id`/`event_id`.html
| 範例檔 | p/_yyyy/_project_id/event_id/index.html | p/project_id/event_id.html <br /> p/project_id/sub_project_id/event_id.html
> `event_id` 是活動 id，其餘同上
> `p/` 底下的 html 網頁檔，會自動抓取 `_data/p/` 底下相同位置的 yml 資料檔，所以 `p/` 跟 `_data/p/` 的資料夾結構要保持一致
> 每個活動都依附在一個專案底下，所以活動的網址裡面一定會包含專案 id

| 其他類型檔案的位置 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 圖片檔（其他類型類推） | p/`YYYY`/`id`/ooo.png <br /> p/`id`/ooo.png | p/`id`/ooo.png <br /> p/`id`/`id`/ooo.png
> 圖片或其他類型的檔案，沒有一定要放在什麼位置，要放專案資料夾、子專案資料夾、或者自己開任何名稱的資料夾都可以，但希望不要放到所屬專案資料夾以外的地方


### 檔頭 YAML front matter 欄位

| layout 欄位 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 專案網頁 | `project` | `p` |
| 活動網頁 | `event` | `e` |
| 自由頁面 | n/a | `f` |

| 專案網頁的欄位 | 舊版 | 新版 |
| -------- | -------- | -------- |
| yml file mapping | `project_id` | automatically detected from page url |
| status (ongoing / closed) | `year`, `current` | retrieved from project data / auto-generated by the system |
| visual elements | `cover_image`, `sidebar_image`, `color` | use project data only |
| special content | `show_budget` | n/a |
| action buttons | `actions` | use project data instead |


| 活動網頁的欄位 | 舊版 | 新版 |
| -------- | -------- | -------- |
| yml file mapping | `year`, `project_id`, `event_id` | automatically detected from page url |
| visual elements | `color`, `veil_opacity` | `project_header_image_opacity`, `project_header_veil_opacity` |
| content | `agenda` | n/a |
| meta data | `summary`, `speakers`, `orgs` | use event data |

## 調整 .yml 資料檔

### 檔案位置

| 專案資料的位置 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 資料檔 | _data/projects/`YYYY`/`id`.yml | _data/p/`id`/project.yml , _data/p/`id`/`id`/project.yml |
| 範例檔 | _data/projects/_project_id.yml | _data/p/project_id/project.yml |

| 活動資料的位置 | 舊版 | 新版 |
| -------- | -------- | -------- |
| 資料檔 | _data/events/`YYYY`.yml , _data/events/`id`.yml | _data/p/`id`/events.yml , _data/p/`id`/`id`/events.yml |
| 範例檔 | _data/events/_project_id.yml , _data/events/_yyyy.yml | _data/p/project_id/events.yml |

> `YYYY` 為年份，如 2019, 2020
> `id` 為專案 id，如 admin, coscup，第二層是子專案的 id

### 資料欄位

| 專案資料的欄位 | 舊版 | 新版 |
| -------- | -------- | -------- |
| provide en version | `name` | all fields |
| basic info | `name`, `description`, `abbr`, `tagline` | same |
| visaul settings | `cover` | `og_image`, `header_image`, `avatar_image`, `theme_color` |
| start / end format | m/dd | yyyy/mm/dd |
| categories | `type_id`, `topic_id`, `field_id`, `tag` | `type_ids`, `topic_ids`, `field_ids`, `tags` |
| links | `link` | `links`, `actions` |
| supported org roles | `advisor`, `organizer`, `co-organizer`, `implementer`, `sponsor` | same |
| supported individual roles | `coordinator`, `consultant`, `volunteer`, `board`, `staff`, `donor`  | same plus `case-handler`, `co-worker`, `contributor`, `host`, `speaker`, `participant` |
| show in project list | see `_data/p/settings.yml` | `listed` |
| others | `meta`, `month` | `metas`, `reports` |

| 活動資料的欄位 | 舊版 | 新版 |
| -------- | -------- | -------- |
| provide en version | n/a | all fields |
| basic info | `title`, `description`, `subtitle` | `name`, `description`, `subtitles` |
| visaul settings | `cover`, `banner`, `avatar` | `cover_image`, `banner_image`, `theme_color` |
| start / end format | m/dd | yyyy/mm/dd |
| categories | `label` | `labels` |
| links | `link` | `links` |
| supported org roles | `advisor`, `organizer`, `co-organizer`, `implementer`, `sponsor` | same |
| supported individual roles | `host`, `speaker`, `contributor`  | same plus project roles |
| others | `meta`, `month` | `metas`, `reports` |

# 第二階段：2021/01 - 2021/02

## 一、影響全站的

所有 .yml 裡面 icon 欄位，除了 semantic ui icons 以外，也支援 font awesome 免費版的 icons（其實原本就應該要有支援，只是 bug 了導致失效…）

## 二、成果報告頁版面寬度設定

多了一個 width 欄位，可以自行指定該頁的內文寬度。詳 p/_yyyy/index.html

## 三、成果報告頁資料設定

詳 _data/reports/_yyyy.yml

頁首標題區塊多了以下欄位可使用
* theme: light / dark
* cover_image_size: (css background-size)
* cover_image_position: (css background-position)
* cover_image_repeat: (css background-repeat)

內文 type: image_header 區塊修正了以下欄位的功能
* background_color: (css color)

內文 type: header 區塊多了以下欄位可使用
* theme: light / dark
* cover_image_size: (css background-size)
* cover_image_position: (css background-position)
* cover_image_repeat: (css background-repeat)

內文 type: content 的 type: image 區塊多了以下欄位可使用
* background: true / false
* background_height: (css min-height)
* background_color: (css color)
* background_size: cover / contain (css background-size)
* background_position: (css background-position)
